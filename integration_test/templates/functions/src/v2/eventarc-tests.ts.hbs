import * as admin from "firebase-admin";
import { onCustomEventPublished } from "firebase-functions/v2/eventarc";
import { sanitizeData } from "../utils";

{{#each functions}}
export const {{name}}{{../testRunId}} = onCustomEventPublished(
  "{{eventType}}",
  async (event) => {
    const testId = event.data.testId;

    await admin
      .firestore()
      .collection("{{collection}}")
      .doc(testId)
      .set(sanitizeData({
        id: event.id,
        type: event.type,
        time: event.time,
        source: event.source,
        data: JSON.stringify(event.data),
      }));
  }
);

{{/each}}
