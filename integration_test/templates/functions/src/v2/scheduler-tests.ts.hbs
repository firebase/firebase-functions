import * as admin from "firebase-admin";
import * as functions from "firebase-functions";
import { onSchedule } from "firebase-functions/v2/scheduler";

const REGION = "{{region}}";

{{#each functions}}
{{#if (eq trigger "onSchedule")}}
export const {{name}}{{../testRunId}} = onSchedule({
  schedule: "{{schedule}}",
  region: REGION,
  timeoutSeconds: {{timeout}}
}, async (event) => {
  const testId = event.jobName;
  if (!testId) {
    functions.logger.error("TestId not found for scheduled function execution");
    return;
  }

  await admin
    .firestore()
    .collection("{{collection}}")
    .doc(testId)
    .set({ success: true });

  return;
});
{{/if}}

{{/each}}