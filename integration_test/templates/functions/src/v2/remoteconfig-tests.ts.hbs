import * as admin from "firebase-admin";
import { onConfigUpdated } from "firebase-functions/v2/remoteConfig";

const REGION = "{{region}}";

{{#each functions}}
{{#if (eq trigger "onConfigUpdated")}}
export const {{name}}{{../testRunId}} = onConfigUpdated({
  region: REGION,
  timeoutSeconds: {{timeout}}
}, async (event) => {
  const testId = event.data.description;

  await admin
    .firestore()
    .collection("{{collection}}")
    .doc(testId)
    .set({
      testId,
      type: event.type,
      id: event.id,
      time: event.time,
    });
});
{{/if}}

{{/each}}