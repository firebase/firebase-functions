import * as admin from "firebase-admin";
import { beforeUserCreated, beforeUserSignedIn } from "firebase-functions/v2/identity";
import { sanitizeData } from "../utils";

{{#each functions}}
export const {{name}}{{../testRunId}} = {{#if (eq type "beforeUserCreated")}}beforeUserCreated{{else}}beforeUserSignedIn{{/if}}(async (event) => {
  const { uid } = event.data;

  await admin.firestore().collection("{{collection}}").doc(uid).set(sanitizeData({
    eventId: event.eventId,
    eventType: event.eventType,
    timestamp: event.timestamp,
    resource: event.resource,
  }));

  return event.data;
});

{{/each}}
