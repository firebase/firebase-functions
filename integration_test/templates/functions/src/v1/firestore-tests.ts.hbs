import * as admin from "firebase-admin";
import * as functions from "firebase-functions/v1";
import { sanitizeData } from "../utils";

const REGION = "{{region}}";

{{#each functions}}
export const {{name}}{{../testRunId}} = functions
  .runWith({
    timeoutSeconds: {{timeout}}
  })
  .region(REGION)
  .firestore.document("{{document}}")
  .{{trigger}}(async ({{#if (eq trigger "onUpdate")}}_change{{else if (eq trigger "onWrite")}}_change{{else}}_snapshot{{/if}}, context) => {
    const testId = context.params.testId;
    await admin
      .firestore()
      .collection("{{collection}}")
      .doc(testId)
      .set(sanitizeData(context));
  });

{{/each}}